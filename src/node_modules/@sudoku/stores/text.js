import { writable } from 'svelte/store';
import {candidates} from './candidates'
import { strategyService } from './strategyService'
import { userGrid } from  './grid'
function createTextStore() {
    // 创建一个字典，存储字符串数组
    const text = writable([]);
    //键为字符串化的usergrid，值为策略名
    const cache = {}
    // 监听 candidates 的变化并更新 text
    candidates.subscribe(($candidates) => {
        const key = JSON.stringify(userGrid.get()); // 将 usergrid 字符串化
        let newText;
        if (cache[key]) {
            newText = cache[key]; // 使用字典中的值
        } else {
            newText = Array.from(strategyService.getNewestValidStrategyList());
            cache[key] = newText; // 将结果存入字典
        }
        text.set(newText);
    });

    return {
        subscribe: text.subscribe,

        set(value) {
            text.set(value);
        },

        get() {
            let value;
            text.subscribe($text => {
                value = $text;
            })();
            return value;
        }
    };
}


export const textStore = createTextStore();
export class NakedSingleStrategy {
    constructor() {}

    // 执行Naked Single策略
    execute(grid, candidates) {
        const newCandidates = JSON.parse(JSON.stringify(candidates)); // 深拷贝避免直接修改原数据
        // 记录总体移除的候选数
        let totalRemoved = 0;
        const maxIterOfStrategy = 1000;
        // 设置迭代上限
        for (let i = 0; i < maxIterOfStrategy; i++) {
            let removed = 0;
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (this.isNakedSingle(newCandidates[row][col])) {
                        const number = newCandidates[row][col][0];
                        removed += this.updateCandidates(row, col, number, newCandidates);
                    }
                }
            }
            totalRemoved += removed;
            if (removed === 0) {
                break;
            }
        }

        return totalRemoved, newCandidates;
    }

    // 判断是否为Naked Single
    isNakedSingle(cellCandidates) {
        return cellCandidates.length === 1;
    }

    // 更新候选数字列表
    updateCandidates(row, col, number, candidates) {
        let removed = 0;
        // 移除当前行、列和小方块中的相同数字
        for (let i = 0; i < 9; i++) {
            // 移除当前行中的候选数字
            if (i !== col && candidates[row][i].includes(number)) {
                candidates[row][i] = candidates[row][i].filter(n => n !== number);
                removed++;
            }
            // 移除当前列中的候选数字
            if (i !== row && candidates[i][col].includes(number)) {
                candidates[i][col] = candidates[i][col].filter(n => n !== number);
                removed++;
            }
        }

        // 移除当前3x3小方块中的候选数字
        const startRow = Math.floor(row / 3) * 3;
        const startCol = Math.floor(col / 3) * 3;
        for (let r = startRow; r < startRow + 3; r++) {
            for (let c = startCol; c < startCol + 3; c++) {
                if ((r !== row || c !== col) && candidates[r][c].includes(number)) {
                    candidates[r][c] = candidates[r][c].filter(n => n !== number);
                    removed++;
                }
            }
        }
        return removed;
    }
}
